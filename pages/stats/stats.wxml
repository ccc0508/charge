<!--pages/stats/stats.wxml-->

<!-- 页面标题 + 月份选择 -->
<view class="stats-header">
  <text class="stats-title">收支统计</text>
  <view class="month-selector">
    <view class="nav-arrow" bindtap="prevMonth">‹</view>
    <text class="nav-title">{{currentMonth}}月</text>
    <view class="nav-arrow" bindtap="nextMonth">›</view>
  </view>
</view>

<!-- 支出扇形图 -->
<view class="chart-section">
  <view class="chart-header">
    <text class="chart-title">支出构成</text>
    <text class="chart-total expense-color">¥{{totalExpense}}</text>
  </view>

  <view wx:if="{{hasExpense}}" class="chart-body">
    <view class="chart-canvas-wrap">
      <canvas id="expenseCanvas" type="2d" class="pie-canvas"></canvas>
    </view>

    <view class="rank-bar-list">
      <view wx:for="{{expenseData}}" wx:key="category" class="rank-bar-item">
        <view class="rank-bar-left">
          <text class="rank-bar-icon">{{item.icon}}</text>
          <text class="rank-bar-label">{{item.label}}</text>
        </view>
        <view class="rank-bar-right">
          <view class="rank-bar-track">
            <view class="rank-bar-fill" style="width: {{item.percent}}%; background: {{item.color}};"></view>
          </view>
          <text class="rank-bar-percent">{{item.percent}}%</text>
        </view>
      </view>
    </view>
  </view>

  <view wx:else class="empty-chart">
    <text class="empty-chart-text">本月暂无支出记录</text>
  </view>
</view>

<!-- 收入扇形图 -->
<view class="chart-section">
  <view class="chart-header">
    <text class="chart-title">收入构成</text>
    <text class="chart-total income-color">¥{{totalIncome}}</text>
  </view>

  <view wx:if="{{hasIncome}}" class="chart-body">
    <view class="chart-canvas-wrap">
      <canvas id="incomeCanvas" type="2d" class="pie-canvas"></canvas>
    </view>

    <view class="rank-bar-list">
      <view wx:for="{{incomeData}}" wx:key="category" class="rank-bar-item">
        <view class="rank-bar-left">
          <text class="rank-bar-icon">{{item.icon}}</text>
          <text class="rank-bar-label">{{item.label}}</text>
        </view>
        <view class="rank-bar-right">
          <view class="rank-bar-track">
            <view class="rank-bar-fill" style="width: {{item.percent}}%; background: {{item.color}};"></view>
          </view>
          <text class="rank-bar-percent">{{item.percent}}%</text>
        </view>
      </view>
    </view>
  </view>

  <view wx:else class="empty-chart">
    <text class="empty-chart-text">本月暂无收入记录</text>
  </view>
</view>

<view style="height: 60rpx;"></view>
