<!--pages/stats/stats.wxml-->

<!-- æœˆä»½é€‰æ‹© -->
<view class="month-nav">
  <view class="nav-arrow" bindtap="prevMonth">â€¹</view>
  <text class="nav-title">{{currentYear}}å¹´{{currentMonth}}æœˆ</text>
  <view class="nav-arrow" bindtap="nextMonth">â€º</view>
</view>

<!-- æ”¯å‡ºæ‰‡å½¢å›¾ -->
<view class="chart-section">
  <view class="chart-header">
    <text class="chart-title">æ”¯å‡ºæ„æˆ</text>
    <text class="chart-total amount-expense">Â¥{{totalExpense}}</text>
  </view>

  <view wx:if="{{hasExpense}}" class="chart-body">
    <view class="chart-canvas-wrap">
      <canvas id="expenseCanvas" type="2d" class="pie-canvas"></canvas>
    </view>
    <view class="legend-list">
      <view wx:for="{{expenseData}}" wx:key="category" class="legend-item">
        <view class="legend-left">
          <view class="legend-dot" style="background:{{item.color}};"></view>
          <text class="legend-icon">{{item.icon}}</text>
          <text class="legend-label">{{item.label}}</text>
        </view>
        <view class="legend-right">
          <text class="legend-amount">Â¥{{item.total}}</text>
          <text class="legend-percent">{{item.percent}}%</text>
        </view>
      </view>
    </view>
  </view>

  <view wx:else class="empty-chart">
    <text class="empty-chart-text">æœ¬æœˆæš‚æ— æ”¯å‡ºè®°å½•</text>
  </view>
</view>

<!-- æ”¶å…¥æ‰‡å½¢å›¾ -->
<view class="chart-section">
  <view class="chart-header">
    <text class="chart-title">æ”¶å…¥æ„æˆ</text>
    <text class="chart-total amount-income">Â¥{{totalIncome}}</text>
  </view>

  <view wx:if="{{hasIncome}}" class="chart-body">
    <view class="chart-canvas-wrap">
      <canvas id="incomeCanvas" type="2d" class="pie-canvas"></canvas>
    </view>
    <view class="legend-list">
      <view wx:for="{{incomeData}}" wx:key="category" class="legend-item">
        <view class="legend-left">
          <view class="legend-dot" style="background:{{item.color}};"></view>
          <text class="legend-icon">{{item.icon}}</text>
          <text class="legend-label">{{item.label}}</text>
        </view>
        <view class="legend-right">
          <text class="legend-amount">Â¥{{item.total}}</text>
          <text class="legend-percent">{{item.percent}}%</text>
        </view>
      </view>
    </view>
  </view>

  <view wx:else class="empty-chart">
    <text class="empty-chart-text">æœ¬æœˆæš‚æ— æ”¶å…¥è®°å½•</text>
  </view>
</view>
<!-- æ”¯å‡ºæ’è¡Œæ¦œ -->
<view class="chart-section" wx:if="{{hasExpense}}">
  <view class="chart-header">
    <text class="chart-title">ğŸ† æ”¯å‡ºæ’è¡Œæ¦œ</text>
    <text class="chart-total" style="color:#999;font-size:24rpx;">TOP {{expenseRank.length}}</text>
  </view>
  <view class="rank-list">
    <view wx:for="{{expenseRank}}" wx:key="id" class="rank-item">
      <view class="rank-left">
        <view class="rank-medal {{item.rank <= 3 ? 'rank-top' : ''}}">{{item.rank === 1 ? 'ğŸ¥‡' : item.rank === 2 ? 'ğŸ¥ˆ' : item.rank === 3 ? 'ğŸ¥‰' : item.rank}}</view>
        <view class="rank-icon">{{item.categoryIcon}}</view>
        <view class="rank-info">
          <text class="rank-label">{{item.categoryLabel}}</text>
          <text class="rank-note">{{item.note || item.date}}</text>
        </view>
      </view>
      <text class="rank-amount amount-expense">{{item.amountText}}</text>
    </view>
  </view>
</view>

<!-- æ”¶å…¥æ’è¡Œæ¦œ -->
<view class="chart-section" wx:if="{{hasIncome}}">
  <view class="chart-header">
    <text class="chart-title">ğŸ† æ”¶å…¥æ’è¡Œæ¦œ</text>
    <text class="chart-total" style="color:#999;font-size:24rpx;">TOP {{incomeRank.length}}</text>
  </view>
  <view class="rank-list">
    <view wx:for="{{incomeRank}}" wx:key="id" class="rank-item">
      <view class="rank-left">
        <view class="rank-medal {{item.rank <= 3 ? 'rank-top' : ''}}">{{item.rank === 1 ? 'ğŸ¥‡' : item.rank === 2 ? 'ğŸ¥ˆ' : item.rank === 3 ? 'ğŸ¥‰' : item.rank}}</view>
        <view class="rank-icon">{{item.categoryIcon}}</view>
        <view class="rank-info">
          <text class="rank-label">{{item.categoryLabel}}</text>
          <text class="rank-note">{{item.note || item.date}}</text>
        </view>
      </view>
      <text class="rank-amount amount-income">{{item.amountText}}</text>
    </view>
  </view>
</view>

<!-- å¹´åº¦æ”¶æ”¯è¶‹åŠ¿æŸ±å½¢å›¾ -->
<view class="chart-section" wx:if="{{hasYearlyData}}">
  <view class="chart-header">
    <text class="chart-title">ğŸ“Š {{currentYear}}å¹´æ”¶æ”¯è¶‹åŠ¿</text>
  </view>

  <!-- å›¾ä¾‹ -->
  <view class="bar-legend">
    <view class="bar-legend-item">
      <view class="bar-legend-dot" style="background: #e74c3c;"></view>
      <text class="bar-legend-text">æ”¯å‡º</text>
    </view>
    <view class="bar-legend-item">
      <view class="bar-legend-dot" style="background: #2ecc71;"></view>
      <text class="bar-legend-text">æ”¶å…¥</text>
    </view>
  </view>

  <!-- æŸ±å½¢å›¾ Canvas -->
  <view class="bar-canvas-wrap">
    <canvas id="yearlyBarCanvas" type="2d" class="bar-canvas"></canvas>
  </view>

  <!-- å¹´åº¦æ±‡æ€» -->
  <view class="yearly-summary">
    <view class="yearly-summary-item">
      <text class="yearly-summary-label">å¹´åº¦æ”¶å…¥</text>
      <text class="yearly-summary-value amount-income">Â¥{{yearlyTotalIncome}}</text>
    </view>
    <view class="yearly-summary-item">
      <text class="yearly-summary-label">å¹´åº¦æ”¯å‡º</text>
      <text class="yearly-summary-value amount-expense">Â¥{{yearlyTotalExpense}}</text>
    </view>
    <view class="yearly-summary-item">
      <text class="yearly-summary-label">å¹´åº¦ç»“ä½™</text>
      <text class="yearly-summary-value" style="color: {{yearlyBalance >= 0 ? '#2ecc71' : '#e74c3c'}}">Â¥{{yearlyBalance}}</text>
    </view>
  </view>
</view>

<!-- åº•éƒ¨ç•™ç™½ -->
<view style="height: 60rpx;"></view>
